import { HomePage } from "@/components/home-page";
import {
  fetchTrendingDay,
  fetchTrendingWeek,
  mNowPlaying,
  mPopular,
  mTopRated,
  mUpcoming,
  tAiringToday,
  tOnTheAir,
  tPopular,
  tTopRated,
} from "@/utils/fetch";
import Head from "next/head";
import { getPlaiceholder } from "plaiceholder";

const Home = ({ data }) => (
    <>
      <Head>
        <title> Flexmovies </title>
        <meta name="description" content="Generated by create next app" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
      </Head>
      <HomePage data={data} />
    </>
  );

export default Home

export async function getServerSideProps(context) {
  const [
    trendDay,
    trendWeek,
    moviesNowPlaying,
    moviesPopular,
    moviesTopRated,
    moviesUpcoming,
    tvPopular,
    tvTopRated,
    tvOnTheAir,
    tvAiringToday,
  ] = await Promise.all([
    fetchTrendingDay("1", process.env.NEXT_PUBLIC_TMDB_API_KEY),
    fetchTrendingWeek("1", process.env.NEXT_PUBLIC_TMDB_API_KEY),
    mNowPlaying(process.env.NEXT_PUBLIC_TMDB_API_KEY),
    mPopular(process.env.NEXT_PUBLIC_TMDB_API_KEY),
    mTopRated(process.env.NEXT_PUBLIC_TMDB_API_KEY),
    mUpcoming(process.env.NEXT_PUBLIC_TMDB_API_KEY),
    tPopular(process.env.NEXT_PUBLIC_TMDB_API_KEY),
    tTopRated(process.env.NEXT_PUBLIC_TMDB_API_KEY),
    tOnTheAir(process.env.NEXT_PUBLIC_TMDB_API_KEY),
    tAiringToday(process.env.NEXT_PUBLIC_TMDB_API_KEY),
  ]);


  const ftdResults = trendDay.results.map(async(data) => {
    const {img, svg} = await getPlaiceholder(`https://image.tmdb.org/t/p/original/${data.poster_path}`)
    return {...data, img, svg}
  })

  const ftd = await Promise.all(ftdResults)

  const ftwResults = trendWeek.results.map(async(data) => {
    data.media = 'movie'
    const {img, svg} = await getPlaiceholder(`https://image.tmdb.org/t/p/original/${data.poster_path}`)
    return {...data, img, svg}
  })

  const ftw = await Promise.all(ftwResults)

  const mnpResults = moviesNowPlaying.results.map(async(data) => {
    data.media = 'movie'
    const {img, svg} = await getPlaiceholder(`https://image.tmdb.org/t/p/original/${data.poster_path}`)
    return {...data, img, svg}
  })

  const mnpr = await Promise.all(mnpResults)

  const mpResults = moviesPopular.results.map(async(data) => {
    data.media = 'movie'
    const {img, svg} = await getPlaiceholder(`https://image.tmdb.org/t/p/original/${data.poster_path}`)
    return {...data, img, svg}
  })

  const mpr = await Promise.all(mpResults)

  const mtResults = moviesTopRated.results.map(async(data) => {
    data.media = 'movie'
    const {img, svg} = await getPlaiceholder(`https://image.tmdb.org/t/p/original/${data.poster_path}`)
    return {...data, img, svg}
  })

  const mtr = await Promise.all(mtResults)

  const mupResults = moviesUpcoming.results.map(async(data) => {
    data.media = 'movie'
    const {img, svg} = await getPlaiceholder(`https://image.tmdb.org/t/p/original/${data.poster_path}`)
    return {...data, img, svg}
  })

  const mup = await Promise.all(mupResults)

  //tv shows
  const tpResults = tvPopular.results.map(async(data) => {
    data.media = 'tv'
    const {img, svg} = await getPlaiceholder(`https://image.tmdb.org/t/p/original/${data.poster_path}`)
    return {...data, img, svg}
  })

  const tp = await Promise.all(tpResults)

  const ttrResults = tvTopRated.results.map(async(data) => {
    data.media = 'tv'
    const {img, svg} = await getPlaiceholder(`https://image.tmdb.org/t/p/original/${data.poster_path}`)
    return {...data, img, svg}
  })

  const ttr = await Promise.all(ttrResults)

  const totaResults = tvOnTheAir.results.map(async(data) => {
    data.media = 'tv'
    const {img, svg} = await getPlaiceholder(`https://image.tmdb.org/t/p/original/${data.poster_path}`)
    return {...data, img, svg}
  })

  const tota = await Promise.all(totaResults)

  const tatResults = tvAiringToday.results.map(async(data) => {
    data.media = 'tv'
    const {img, svg} = await getPlaiceholder(`https://image.tmdb.org/t/p/original/${data.poster_path}`)
    return {...data, img, svg}
  })

  const tat = await Promise.all(tatResults)

  const data = {
    trendDay: {...trendDay, results: ftd},
    trendWeek: {...trendWeek, results: ftw},
    moviesNowPlaying: {...moviesNowPlaying, results: mnpr},
    moviesPopular: {...moviesPopular, results: mpr},
    moviesTopRated: {...moviesTopRated, results: mtr},
    moviesUpcoming: {...moviesUpcoming, results: mup},
    tvPopular: {...tvPopular, results: tp},
    tvTopRated: {...tvTopRated, results: ttr},
    tvOnTheAir: {...tvOnTheAir, results: tota},
    tvAiringToday: {...tvAiringToday, results: tat},
  };

  return {
    props: {
      data,
    },
  };
}
